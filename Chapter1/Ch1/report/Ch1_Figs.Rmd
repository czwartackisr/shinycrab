---
title: "Predicting blue crab (*Callinectes sapidus*) fisheries independent survey abundances and commercial landings in Charleston Harbor, South Carolina"
subtitle: "28Jan2020 edit: 1"
author:
  - Stephen R. Czwartacki
  - Michael R. Kendrick
abstract: |
  Marked high fluctuations in blue crab (*Callinectes sapidus*) seasonal and annual abundance, and commercial landings are typical, but data from both fisheries independent and dependent surveys have shown declines in populations in recent years in South Carolina. Despite several long-term fisheries independent surveys encountering blue crab, predictive models have not recently been developed in South Carolina to quantify variation in abundance and commercial landings.   The goal of this study is to assess the current status of blue crab in SC and explore the potential for developing a more predictive understanding of commercial landings. This goal is met through the following objectives: 1) assess long-term trends in blue crab landings and fisheries-independent abundance, 2) test the applicability of a juvenile index, where juvenile abundance in one year predicts adult abundance in a following year, 3) explore predictive relationships between fisheries-independent abundance and commercial landings. Data from several long-term South Carolina Department of Natural Resources (SCDNR) fisheries independent blue crab surveys were standardized for each of six surveys and commercial landings data were compiled.  Analyses testing the application of a juvenile index of abundance show that no juveniles collected in surveys explain variation in annual survey abundances.  The Creek Trawl survey was the only survey with significant, but weak, correlative relationships between multiple lagged population structure variables and its own annual abundance.  Significant relationships were found with effort-corrected commercial landings predicted by the previous yearâ€™s abundance of male crabs. This relationship was significant for immature crabs collected in the Harbor Trawl survey, and for mature crabs collected in the Creek Trawl survey. These results suggest effective population sampling, but a potential influence on abundance of blue crab from outside factors such as fishing, habitat or environmental variables.   
output:
  pdf_document: default
  word_document: default
editor_options: 
  chunk_output_type: inline
---


```{r knitr setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE, echo=FALSE}
library(ggplot2)
library(lubridate)
library(tidyr)
library(dplyr)
library(Hmisc)
library(nlme)
library(cowplot)
library(MuMIn)
library(grid)
library(gridExtra)
library(ggpmisc)
library(knitr)
library(tinytex)
library(kableExtra)

theme_set(theme_classic(base_size = 12)+
            theme(panel.grid.major = element_blank(), 
                  panel.grid.minor = element_blank(),
                  panel.background = element_rect(colour = "black", size=0.5))+
            theme(text=element_text(size=12,  family="serif", colour = "black"))+
            theme(axis.text = element_text(colour = "black"))+
            theme(axis.ticks = element_line(colour = "black"))
)
update_geom_defaults("point",   list(colour = "black"))
update_geom_defaults("line",   list(colour = "black"))
theme_update(plot.title = element_text(hjust = 0.5))
```



```{r Data Read-In, include=FALSE, warning=FALSE, message=FALSE}

crabdata <- read.csv("ClassSizeAbunDistinct_201912.csv", stringsAsFactors = FALSE) 


#Source - Eric Hiltz OFM Fisheries Statistics
#Wrangled in Excel due to confidentiality
depend <- read.csv("MonthlyDependent.csv") 
```

```{r Data Wrangling, include=FALSE, warning=FALSE, message=FALSE}
B90T38 = crabdata %>% #Formerly crab1
  dplyr::select(1:4, 7:16) %>%
  filter(ProjID %in% c("B90", "T38")) %>%
  rename(Total = CPUE,
         Juvenile = JuvCPUE,
         Subadult = SubadultCPUE,
         Adult = AdultCPUE,
         "Immature Female" = ImmatureFemaleCPUE,
         "Mature Female" = MatureFemaleCPUE,
         "Immature Male" = ImmatureMaleCPUE,
         "Mature Male" = MatureMaleCPUE,
         Sublegal = SublegalCPUE,
         Legal = LegalCPUE) %>%
  gather("Lifestage", "CPUE", 5:14) %>%
  mutate(Year = year(StartTime)) %>%
  mutate(Month = month(StartTime)) %>%
  dplyr::select(1,2,4,3,7,8,5,6) 

T06 = crabdata %>% #Formerly crab1
  dplyr::select(1:4, 7:16) %>%
  filter(ProjID %in% "T06") %>%
  rename(Total = CPUE) %>%
  dplyr::select(1:5) %>%
  gather("Lifestage", "CPUE", 5) %>%
  mutate(Year = year(StartTime)) %>%
  mutate(Month = month(StartTime)) %>%
  dplyr::select(1,2,4,3,7,8,5,6) 


P88 = crabdata %>% #Formerly crab1
  dplyr::select(1:4, 7:16) %>%
  filter(ProjID %in% "P88") %>%
  rename(Total = CPUE,
         Sublegal = SublegalCPUE,
         Legal = LegalCPUE) %>%
  distinct(Coll, .keep_all = TRUE) %>%
  dplyr::select(1:5, 13, 14) %>%
  gather("Lifestage", "CPUE", 5:7) %>%
  mutate(Year = year(StartTime)) %>%
  mutate(Month = month(StartTime)) %>%
  dplyr::select(1,2,4,3,7,8,5,6) 

p88Crab = crabdata %>% #Formerly crab1
  dplyr::select(1:4, 7:16) %>%
  filter(ProjID %in% "P88") 


SCECAP = crabdata %>% #Formerly crab1
  dplyr::select(1:4, 7:16) %>%
  filter(ProjID %in% c("E98", "E99")) %>%
  rename(Total = CPUE,
         Sublegal = SublegalCPUE,
         Legal = LegalCPUE,
         Juvenile = JuvCPUE,
         Subadult = SubadultCPUE,
         Adult = AdultCPUE) %>%
  dplyr::select(1:8, 13, 14) %>%
  gather("Lifestage", "CPUE", 5:10) %>%
  mutate(Year = year(StartTime)) %>%
  mutate(Month = month(StartTime)) %>%
  dplyr::select(1,2,4,3,7,8,5,6) 

crab1 = rbind(B90T38, P88) %>%
  rbind(., T06) %>%
  rbind(., SCECAP)



#Source - Eric Hiltz OFM Fisheries Statistics
#Wrangled in Excel due to confidentiality
depend <- read.csv("MonthlyDependent.csv")


#Joining Independent and Dependent 
crab3 = full_join(crab1, depend,
                  by = c("ProjID", "StationCode", "Year", 
                         "Month", "Lifestage", "CPUE")) %>%
  mutate(ProjID = as.factor(ProjID)) %>%
  mutate(Coll = as.factor(Coll)) %>%
  mutate(StationCode = as.factor(StationCode)) %>%
  mutate(StartTime = ymd_hms(StartTime)) %>%
  mutate(Year = as.numeric(Year)) %>%
  mutate(Month = as.factor(Month)) %>%
  mutate(Lifestage = as.factor(Lifestage)) %>%
  group_by(ProjID, StationCode, Lifestage, Month) %>%
  mutate(Means = mean(CPUE, na.rm=TRUE),
         SDs = sd(CPUE, na.rm=TRUE),
         Zs = (CPUE-Means)/ifelse(SDs>0,SDs, 0.00000001)) %>%
  ungroup() 

#StartTime will not operate in posix due to missing values from depend

crab = crab3 %>%
  mutate(ProjID = recode(ProjID, 'B90' = "Harbor Trawl",
                         'T38' = "Creek Trawl",
                         'T06' = "Trammel Net",
                         'P88' = "Ashley Potting",
                         'E98' = "SCECAP Creek Trawl",
                         'E99' = "SCECAP Harbor Trawl")) %>%
  filter(Year > 1979)


```
\newpage
## Methods

Data were put through a rigorous data wrangling process to standardize each survey relative to its own methods.  Fisheries dependent commercial landings and fisheries independent survey abundances were truncated from statewide data to Charleston Harbor watershed data.  

Surveys cover a range of habitats.  

```{r, echo=FALSE, warning=FALSE, include=FALSE}
SurveyTable = read.csv("SurveyTable.csv") %>%
  rename("Gear Method" = Gear.Method,
         "Gear Type" = Gear.Type,
         "Sample Area" = Sample.Area,
         "Sample Interval" = Sample.Interval,
         "Sample Method" = Sample.Method,
         "N(events)" = N.events.,
         "CPUE Standardization" = CPUE.Standardization) 

SurveyClass = read.csv("SurveyClass.csv") %>%
  rename("Total CPUE" = Total.CPUE,
         "Immature Female" = Immature.Female,
         "Mature Female" = Mature.Female,
         "Immature Male" = Immature.Male,
         "Mature Male" = Mature.Male) 

```

**Table 1:** Methods - SCDNR fisheries independent survey methodology.  This table sums up some of the differences in methodology from each of the survey.  I think it covers a range of of different methodology variables (temporal, spatial, gear, standardization, sample numbers, etc.).  
```{r Survey Background, include=TRUE, echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Table 1: SCDNR fisheries independent survey methodology"}
Ch1_Table = kable(SurveyTable, "latex", booktabs = T) %>%
  kable_styling(latex_options = "scale_down" , font_size = 8) %>%
  add_header_above(c(" " = 1, "Gear" = 2, "Sample" = 3, "Data" = 2)) %>%
  pack_rows("CRMS", 1,3) %>%
  pack_rows("ERS", 4,5) %>%
  pack_rows("IFRS", 6,6) %>%
  column_spec(7, width = "5em") %>%
  column_spec(3:6, width = "6em") %>%
  column_spec(8, width = "7em")

Ch1_Table

```

**Table 2:** Lifestage data for blue crab by SCDNR fisheries independent survey.  It should be mentioned in the methods what type of lifestage data is available from these surveys.  The "legal" category is pretty redundant.  "Legal" = "Adult, and "Sublegal" = "Juvenile" + "Subadult", although at shows the potting survey having some size data and sublegal can be considered a joint variable (juv + subadult).  
```{r Survey Data, include=TRUE, echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Table 2: Lifestage data for blue crab by SCDNR fisheries independent survey"}
Ch1_SurveyLifestageTable = kable(SurveyClass, "latex", booktabs = T, align = "lcccccccccc") %>%
  kable_styling(latex_options = "scale_down" , font_size = 8) %>%
  add_header_above(c(" " = 2, "Size" = 3, "Legal (Size)" = 2, "Class (Sex/Maturity)" = 4)) %>%
  pack_rows("CRMS", 1,3) %>%
  pack_rows("ERS", 4,5) %>%
  pack_rows("IFRS", 6,6) 

Ch1_SurveyLifestageTable

```

\newpage

# Objective 1
Assess long-term trends in blue crab landings and fisheries-independent abundance

```{r Figure 1, echo=FALSE, message=FALSE, warning=FALSE,dpi=600, fig.cap="Objective 1 - Plot represents mean annual time series of (A) total landings in total lbs./yr and (B) mean annual effort-corrected landings (total lbs./pot pulled/yr) for the combined reporting areas of the Charleston Harbor watershed", fig.height=6}
LandingsCPUEFormTotal = subset(crab,
                           ProjID == "LandingsCPUEMean")

formula1 <- lm(LandingsCPUEFormTotal$CPUE ~ LandingsCPUEFormTotal$Year)

LandingsCrab = crab %>%
  filter(ProjID == c("LandingsSum", "LandingsCPUEMean")) %>%
  group_by(ProjID) %>%
  mutate(Means = mean(CPUE, na.rm=TRUE),
         SDs = sd(CPUE, na.rm=TRUE),
         Zs = (CPUE-Means)/ifelse(SDs>0,SDs, 0.00000001)) %>%
  ungroup() 


LandingsCPUE = ggplot(aes(Year, CPUE), data = subset(LandingsCrab,
                                                     ProjID == "LandingsCPUEMean")) +
  #ggtitle("Commercial Landings CPUE\nCharleston Harbor (Combined Watersheds)") +
  geom_hline(aes(yintercept=mean(CPUE)), linetype="dashed") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula1, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  labs(y=expression(Blue~crab~pot~fished^{-1})) +
  expand_limits(x=c(1980, 2022)) 





LandingsFormTotal = subset(crab,
                      ProjID == "LandingsSum") 
formula2 <- lm(LandingsFormTotal$CPUE ~ LandingsFormTotal$Year)
Landings = ggplot(aes(Year, CPUE), data = subset(LandingsCrab,
                                                 ProjID == "LandingsSum")) +
  ggtitle("Commercial Landings\nCharleston Harbor (Combined Watersheds)") +
  geom_hline(aes(yintercept=mean(CPUE)), linetype="dashed") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula2, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  labs(y=expression(Blue~crab~lbs.~year^{-1}), x=expression(" ")) +
  expand_limits(x=c(1980, 2022)) 


LandingsTimeSeries <- plot_grid(Landings, LandingsCPUE, ncol = 1, align = 'hv', labels = c("A", "B"))

LandingsTimeSeries

```

```{r B90 Size Wrangle, include=FALSE, warning=FALSE, message=FALSE}
LegalCrab = crab %>%
  filter(Lifestage == "Legal")
LegalCrab$ProjID <- factor(LegalCrab$ProjID, levels = c("Harbor Trawl",
                                                        "SCECAP Harbor Trawl",
                                                        "Creek Trawl",
                                                        "SCECAP Creek Trawl",
                                                        "Trammel Net",
                                                        "Ashley Potting"))

B90FormLegal = subset(LegalCrab,
                     ProjID == "Harbor Trawl")
formula3 <- lm(B90FormLegal$CPUE ~ B90FormLegal$Year)
B90LegalCPUE = ggplot(aes(Year, CPUE), data = subset(LegalCrab,
                                                     ProjID == "Harbor Trawl")) +
  ggtitle(" ") +
  #ggtitle("Harbor Trawl") + 
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula3, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  geom_hline(aes(yintercept=mean(Means)), linetype="dashed") +
  labs(y=expression(Adult~CPUE^{-1}), x=expression(" ")) +
  #labs(y=expression(Blue~crab~per~tow^{-1})) +
  expand_limits(x=2020)
#B90LegalCPUE

T38FormLegal = subset(LegalCrab,
                     ProjID == "Creek Trawl")
formula4 <- lm(T38FormLegal$CPUE ~ T38FormLegal$Year)
T38LegalCPUE = ggplot(aes(Year, CPUE), data = subset(LegalCrab,
                                                     ProjID == "Creek Trawl")) +
  ggtitle(" ") +
    #ggtitle("Creek Trawl") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula4, parse = TRUE, label.x = "right") +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  geom_hline(aes(yintercept=mean(Means)), linetype="dashed") +
  labs(y=expression(" "), x=expression(" ")) +
  #labs(y=expression(Blue~crab~per~tow^{-1})) +
  expand_limits(x=2020)
#T38LegalCPUE

E98FormLegal = subset(LegalCrab,
                     ProjID == "SCECAP Creek Trawl")
formula6 <- lm(E98FormLegal$CPUE ~ E98FormLegal$Year)
E98LegalCPUE = ggplot(aes(Year, log(CPUE)), data = subset(LegalCrab,
                                                          ProjID == "SCECAP Creek Trawl")) +
  ggtitle(" ") +
  #ggtitle("SCECAP Tidal Creek Trawl") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula6, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  geom_hline(aes(yintercept=(log(mean(Means)))), linetype="dashed") +
  labs(y=expression(Adult~CPUE^{-1}), x=expression(" ")) +
  #labs(y=expression((log)~Blue~crab~per~tow^{-1})) +
  expand_limits(x=c(1980,2020)) +
  coord_cartesian(ylim = c(0,8))

E99FormLegal = subset(LegalCrab,
                     ProjID == "SCECAP Harbor Trawl")
formula7 <- lm(E99FormLegal$CPUE ~ E99FormLegal$Year)
E99LegalCPUE = ggplot(aes(Year, CPUE), data = subset(LegalCrab,
                                                     ProjID == "SCECAP Harbor Trawl")) +
  ggtitle(" ") +
  #ggtitle("SCECAP Open Water Trawl") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula7, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  geom_hline(aes(yintercept=mean(Means)), linetype="dashed") +
  labs(y=expression(" "), x=expression(" ")) +
  #labs(y=expression(Blue~crab~per~tow^{-1})) +
  expand_limits(x=c(1980,2020)) 

P88FormLegal = subset(LegalCrab,
                     ProjID == "Ashley Potting")
formula8<- lm(P88FormLegal$CPUE ~ P88FormLegal$Year)
P88FallLegalCPUE = LegalCrab %>%
  filter(ProjID == "Ashley Potting") %>%
  filter(Month %in% c("10", "11"))
P88FallLegalCPUE = ggplot(aes(Year, CPUE), data = subset(LegalCrab,
                                                         ProjID == "Ashley Potting")) +
  ggtitle(" ") +
  #ggtitle("Ashley River Potting Survey (fall)") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula8, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black", na.rm = TRUE) +
  geom_hline(aes(yintercept=mean(Means)), linetype="dashed") +
  labs(y=expression(Adult~CPUE^{-1}), x=expression("Year")) +
  #labs(y=expression(Blue~crab~per~soak^{-1})) +
  expand_limits(x=c(1980,2020))


T06TotalCrab = crab %>%
  filter(Lifestage == "Total",
         ProjID == "Trammel Net")
                              
formula4 <- lm(T06TotalCrab$CPUE ~ T06TotalCrab$Year)
T06TotalCPUE = ggplot(aes(Year, CPUE), data = T06TotalCrab) +
  ggtitle(" ") +
    #ggtitle("Creek Trawl") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula4, parse = TRUE, label.x = "right") +
  geom_smooth(method = 'loess', se=FALSE, color="black") +
  geom_hline(aes(yintercept=mean(Means)), linetype="dashed") +
  labs(y=expression(Total~CPUE^{-1}), x=expression(" ")) +
  #labs(y=expression(Blue~crab~per~tow^{-1})) +
  expand_limits(x=c(1980, 2020))
#T38LegalCPUE


##Only going to use this if we need a year-round look, but only goes to 2003
P88FormLegal2 = subset(LegalCrab,
                      ProjID == "Ashley Potting" &
                        Year > 2002)
formula9 <- lm(P88FormLegal$CPUE ~ P88FormLegal$Year)
P88LegalAnnualCPUE = ggplot(aes(Year, CPUE), data = subset(LegalCrab,
                                                           ProjID == "Ashley Potting" &
                                                             Year > 2002)) +
  ggtitle(" ") +
  #ggtitle("Ashley River Potting Survey (bi-monthly)") +
  stat_summary(fun.data = "mean_se", size = .7) +
  #stat_poly_eq(aes(label = ..eq.label..), formula = formula9, parse = TRUE) +
  geom_smooth(method = 'loess', se=FALSE, color="black", na.rm = TRUE) +
  geom_hline(aes(yintercept=mean(Means)), linetype="dashed") +
  labs(y=expression(" "), x=expression("Year")) +
  #labs(y=expression(Blue~crab~per~soak^{-1})) +
  expand_limits(x=c(1980,2020))
```


```{r Figure 2 (CRMS Survey Time Series), echo=FALSE, message=FALSE, warning=FALSE,dpi=600, fig.cap="Objective 1 - Plot represents mean annual adult survey abundances of the (A) Harbor Trawl, (B) Creek Trawl, (C) Ashley Potting Survey, (D) SCECAP Open-Water and (E) SCECAP Tidal-Creek surveys, with standard error, long-term mean (dashed) and a LOESS smoothing line (solid).  The Tammel Net survey does not have size or sexual maturity data and is represented by total CPUE in this plot.", fig.width=10,fig.height=11}

CRMSLegalTimeSeries <- plot_grid(B90LegalCPUE, T38LegalCPUE, P88FallLegalCPUE, 
                                E99LegalCPUE, E98LegalCPUE, T06TotalCPUE, 
                                ncol = 2, align = 'hv',
                                labels = c("A", "B", "C", "D", "E", "F")) 
title1 <- ggdraw() + draw_label("Fisheries Independent Survey Abundances\nCharleston Harbor (Combined Watersheds)", fontfamily = "serif")


Plot1 <- plot_grid(title1, CRMSLegalTimeSeries, ncol = 1, rel_heights=c(0.1, 1))
Plot1


```

\newpage
### Methods



### Discussion

Time series of mean annual commercial landings (Fig. 1) and adult abundances from SCDNR fisheries independent surveys (fig. 2) show the high inter-annual variablility of legal-sized "adult" blue crab (>126mm).  These figures both show crab >126mm, which is the minimum legal limit of blue crab in South Carolina.  

The total pounds landed in the combined Charleston Harbor watersheds shows a trending decline from 2003 - 2010, but when these same landings data are corrected for effort in terms of number of pots pulled that trend is not observed.  The year 2003 marks the first year of "trip ticket" reporting, in which all commercial blue crab license holders are required to report their catch.  This is the same time (>2003) landings data have incorporated data from the Ashley River and Cooper River reporting areas.  This could be due to not being actively fished for blue crab, underreported for these reporting areas or included in another reporting area (e.g. a line of crab pots beginning in the Ashley River and continuing into Charleston Harbor where landings are eventually reported). Adult abundances from some surveys (B Creek Trawl, C Ashley Potting and D SCECAP Open-Water) show a slight decline in adult abundance shortly after 2000.  

\newpage
# Objective 2 
Test the ability of a juvenile index of adult abundance, where juvenile abundance in one year predicts adult abundance in a following year

 Creek Trawl (1-yr lag, r^2^ = 0.02, *p* = 0.43; 2-yr lag, r^2^ = 0.02, *p* = 0.35) or the Harbor Trawl (1-yr lag, r^2^ = 0.06, *p* = 0.15; 2-yr lag, r^2^ = 0.00, *p* = 0.86) survey. 

**Table 3:** Objective 2 - Mean annual juvenile CPUE was not significantly related to mean annual adult CPUE in subsequent years for any survey
```{r Table 3, include=TRUE, echo=FALSE, warning=FALSE, include=TRUE, dpi=600, fig.cap="Table 4: OLS regression of total Creek Trawl CPUE by all lifestages from all surveys."}
IndexRegressTable = read.csv("IndexRegress.csv") %>%
  rename("Explanatory Variable" = Explanatory.Variable,
         "Dpendent Variable" = Dependent.Variable,
         "p-value" = p.value,
         "r2" = r2,
         "Degrees of Freedom" = Degrees.of.Freedom) %>%
  dplyr::select(1, 3:6)


Index_Table =  kable(IndexRegressTable, "latex", booktabs = T, align = "llccc") %>%
  kable_styling(font_size = 8) %>%
  add_header_above(c(" " = 2, "Summary Statistics" = 3)) %>%
  column_spec(3:4, width = "4em") %>%
  column_spec(5, width = "6em") %>%
  pack_rows("Harbor Trawl", 1,2) %>%
  pack_rows("Creek Trawl", 3, 4) %>%
  pack_rows("SCECAP Open Water", 5, 6) %>%
  pack_rows("SCECAP Tidal Creek", 7, 8) %>%
  pack_rows("Ashley Potting", 9, 10)

Index_Table

```

```{r, Figure 3a Wrangle, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}
#This is just in case I have to produce regression plots of these failed relationships



AbunPlotcrab <- read.csv("CH1data.csv", stringsAsFactors = FALSE)

B90JuvLag_lm1 = lm(AbunPlotcrab$B90_AdultCPUE ~ lag(AbunPlotcrab$B90_JuvCPUE, 1))
B90JuvLagPlot = ggplot(aes(B90_AdultCPUE, lag(AbunPlotcrab$B90_JuvCPUE, 1)), data = AbunPlotcrab) +
  ggtitle("Harbor Trawl") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = B90JuvLag_lm1),
                  label.x = "right",
                  label.y = "top",
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 2), sep = "")),
                  parse = TRUE, size = 3.2) +
  #stat_poly_eq(aes(label = paste(..rr.label..)), 
               #label.x.npc = "right", label.y.npc = 0.12,
               #formula = B90JuvLag_lm1,rr.digits = 2,  parse = TRUE, size = 3.2) +
  #geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(Adult~CPUE~year^{-1}),
       x=expression(Juvenile~CPUE~year^{-1}~"(1-yr. lag)"))

B90JuvLead_lm1 = lm(AbunPlotcrab$B90_AdultCPUE ~ lag(AbunPlotcrab$B90_JuvCPUE, 2))
B90JuvLeadPlot = ggplot(aes(B90_AdultCPUE, lag(AbunPlotcrab$B90_JuvCPUE, 2)), data = AbunPlotcrab) +
  #ggtitle("Index of Abundance Relationship") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = B90JuvLead_lm1),
                  label.x = "right",
                  label.y = "top",
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 2), sep = "")),
                  parse = TRUE, size = 3.2) +
  #stat_poly_eq(aes(label = paste(..rr.label..)), 
               #label.x.npc = "right", label.y.npc = 0.12,
               #formula = B90JuvLag_lm1,rr.digits = 2,  parse = TRUE, size = 3.2) +
  #geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(Adult~CPUE~year^{-1}),
       x=expression(Juvenile~CPUE~year^{-1}~"(2-yr. lag)"))

T38JuvLag_lm1 = lm(AbunPlotcrab$T38_AdultCPUE ~ lag(AbunPlotcrab$T38_JuvCPUE, 1))
T38JuvLagPlot = ggplot(aes(T38_AdultCPUE, lag(AbunPlotcrab$T38_JuvCPUE, 1)), data = AbunPlotcrab) +
  ggtitle("Creek Trawl") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = T38JuvLag_lm1),
                  label.x = "right",
                  label.y = "top",
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 2), sep = "")),
                  parse = TRUE, size = 3.2) +
  #stat_poly_eq(aes(label = paste(..rr.label..)), 
               #label.x.npc = "right", label.y.npc = 0.12,
               #formula = T38JuvLag_lm1,rr.digits = 2,  parse = TRUE, size = 3.2) +
  #geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(Adult~CPUE~year^{-1}),
       x=expression(Juvenile~CPUE~year^{-1}~"(1-yr. lag)"))

T38JuvLead_lm1 = lm(AbunPlotcrab$T38_AdultCPUE ~ lag(AbunPlotcrab$T38_JuvCPUE, 2))
T38JuvLeadPlot = ggplot(aes(T38_AdultCPUE, lag(AbunPlotcrab$T38_JuvCPUE, 2)), data = AbunPlotcrab) +
  #ggtitle("Index of Abundance Relationship") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = T38JuvLead_lm1),
                  label.x = "right",
                  label.y = "top",
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 2), sep = "")),
                  parse = TRUE, size = 3.2) +
  #stat_poly_eq(aes(label = paste(..rr.label..)), 
               #label.x.npc = "right", label.y.npc = 0.12,
               #formula = T38JuvLag_lm1,rr.digits = 2,  parse = TRUE, size = 3.2) +
  #geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(Adult~CPUE~year^{-1}),
       x=expression(Juvenile~CPUE~year^{-1}~"(2-yr. lag)"))

```


\newpage
# Objective 3
Explore predictive relationships between fisheries-independent abundance and commercial landings

```{r, echo=FALSE, warning=FALSE, include=FALSE}
AbunRegressTable = read.csv("SingleAbundanceRegress.csv") %>%
  rename("Degrees of Freedom" = Degrees.of.Freedom,
         "Explanatory Variable" = Explanatory.Variable,
         "Dependent Variable" = Dependent.Variable,
         "p-value" = p.value) %>%
  dplyr::select(2, 4:6, 8)

```

**Table 4:** Objective 3 - These are all relevant explanatory variables.  Only one survey has explanatory relationships with its own lagged abundances.  No juveniles from any survey predict abundances in later years.  The realtionship between total CPUE and subadults with a 2-yr. may suggest that 1) the survey does not catch juveinles effectively or juveniles are not populating sampled micro-habitats. 
```{r T38, include=TRUE, echo=FALSE, warning=FALSE, include=TRUE, dpi=600, fig.cap="Table 3: OLS regression of total Creek Trawl CPUE by all lifestages from all surveys."}

Abun_Table =  kable(AbunRegressTable, "latex", booktabs = T, align = "llcccc") %>%
  kable_styling(latex_options = "scale_down" , font_size = 8) %>%
  add_header_above(c(" " = 2, "Summary Statistics" = 3)) %>%
  column_spec(3:5, width = "6em")

Abun_Table

```

\newpage

```{r Figure 4 (Sub Plot), echo=FALSE, message=FALSE, warning=FALSE, include=TRUE, fig.cap="Objective 2 - Plot showing the regression relationship of total Creek Trawl CPUE by Creek Trawl subadult CPUE from 2 years prior.  This the highest correlated relationship of total or adult CPUE by lagged lifestage variable.", fig.width=5,fig.height=3}
T38AbunLead_lm2 = lm(AbunPlotcrab$T38_CPUE ~ lag(AbunPlotcrab$T38_SubadultCPUE, 2))
T38AbunLeadPlot = ggplot(aes(T38_CPUE, lag(AbunPlotcrab$T38_SubadultCPUE, 2)), data = AbunPlotcrab) +
  #ggtitle("Index of Abundance Relationship") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = T38AbunLead_lm2),
                  label.x = "right",
                  label.y = "bottom",
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 2), sep = "")),
                  parse = TRUE, size = 3.2) +
  stat_poly_eq(aes(label = paste(..rr.label..)), 
               label.x.npc = "right", label.y.npc = 0.12,
               formula = T38AbunLead_lm2,rr.digits = 2,  parse = TRUE, size = 3.2) +
  geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(CPUE~year^{-1}),
       x=expression(Subadult~CPUE~"(2-yr. lag)"~year^{-1}))

T38AbunLeadPlot
```

\newpage
### Discussion
OLS regression models using all lifestages from all surveys with a 1- and 2-yr lag to predict all survey's total CPUEs were constructed to find all explanatory relationships.  The CRMS Creek Trawl survey is the most consistently responsive of the surveys when used in regression modeling.  Fifteen significant relationships exist between total CPUEs from the Creek Trawl survey and several 1- and 2-yr.lagged lifestage variables (Table 3).  The CRMS Harbor Trawl had one significant explanatory relationship with subadults from the same survey lagged 1-yr.  The Trammel Net survey had one significant explanatory relatioship with mature females from the Harbor Trawl lagged 1-yr, which is the highest correlation (r<sup>2</sup>=0.36) of all the single regression models.  
\newline
Although there were several significant regression models constructed using fisheries independent survey life stage abundance CPUEs, no relationships correlate strong enough to be effective models.  Using OLS single regression modeling, the six SCDNR fisheries independent surveys used to monitor blue crab populations in the Charleston Harbor watershed are ineffective predictors of their own abundance CPUEs.  When these single variables were used to populate multiple regression OLS models, the adjusted R^2 values did not improve the correlations.  Juvenile variables did not predict mean annual CPUEs.

\newpage
# Objective 3
Explore predictive relationships between fisheries-independent abundance and commercial landings. 

**Table 5:** Objective 3 - All significant relatioships of effort corrected Charleston Harbor watershed (Ashley, Cooper and Wando Rivers and Charlesotn Harbor) commercial Landings by lifestage variables from all surveys using OLS regression. Only variables from the Harbor and Creek Trawl surveys were related to these corrected landings.  Multiple variables with consistent correlations through both surveys seem to suggest the surveys are effectively measuring the population, but there may be some other driver (habitat, environmental, fishing) outside of stock/population (proper term?) variables that affect blue crab abundance.
```{r Table 5, include=TRUE, echo=FALSE, warning=FALSE, include=TRUE, dpi=600, fig.cap="Table 4: OLS regression of total Creek Trawl CPUE by all lifestages from all surveys."}
LandRegressTable = read.csv("SingleLandingsCPUERegress.csv") %>%
  rename("Degrees of Freedom" = Degrees.of.Freedom,
         "Explanatory Variable" = Explanatory.Variable,
         "Dependent Variable" = Dependent.Variable,
         "p-value" = p.value,
         "F-statistic" = F.statistic) %>%
  dplyr::select(2, 4:8)


Land_Table =  kable(LandRegressTable, "latex", booktabs = T, align = "llcccc") %>%
  kable_styling(latex_options = "scale_down" , font_size = 8) %>%
  add_header_above(c(" " = 2, "Summary Statistics" = 4)) %>%
  column_spec(3:6, width = "6em") %>%
  pack_rows("Harbor Trawl (explanatory variable)", 1,3) %>%
  pack_rows("Creek Trawl (explanatory variable)", 4, 9) 

Land_Table

```

```{r Figure 5, echo=FALSE, message=FALSE, warning=FALSE,dpi=600, fig.cap="Ordinary Least Squares regression plots of select significant explanatory relatioships using lagged variables to Charleston Harbor watershed Landings CPUEs.  Mean annual landings CPUE by Harbor Trawl mature males with a 1-yr lag (A), and mean annual landings CPUE by Creek Trawl immature males CPUE with a 1-yr. lag (B).  Because the multiple regression relationships do not have as strong a correlation as some of the single, and are more illogical, I don't think the table with multiple regression models is needed since their is no improvement in correlation.", fig.width=5,fig.height=6}

LandPlotcrab <- read.csv("CH1data.csv", stringsAsFactors = FALSE)

B90CPUELAG_lm8 <- lm(LandPlotcrab$LandingsCPUEMean ~ lag(LandPlotcrab$B90_MatureMaleCPUE, 1))
B90CPUELagPlot = ggplot(aes(LandingsCPUEMean, lag(B90_MatureMaleCPUE, 1)), data = LandPlotcrab) +
  #ggtitle("Commercial Landings ~ Select Survey Variables") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = B90CPUELAG_lm8),
                  label.x = "right",
                  label.y = 0.865,
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 4), sep = "")),
                  parse = TRUE, size = 3.2) +
  stat_poly_eq(aes(label = paste(..rr.label..)), 
               label.x.npc = "right", 
               label.y.npc = "top",
               formula = B90CPUELAG_lm8,rr.digits = 4,  parse = TRUE, size = 3.2) +
  geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(Landings~CPUE~year^{-1}),
       x=expression(Harbor~Trawl~mature~male~CPUE~"(1-yr lag)"~year^{-1}))


T38CPUELAG_lm7 <- lm(LandPlotcrab$LandingsCPUEMean ~ lag(LandPlotcrab$T38_ImmatureMaleCPUE, 1))
T38CPUELAGPlot = ggplot(aes(LandingsCPUEMean, lag(T38_ImmatureMaleCPUE, 2)), data = LandPlotcrab) +
  ylim(0, 4) +
  #ggtitle("Landings CPUE \nby Creek Trawl Immature Male (1-yr. lag)") +
  geom_point() +
  stat_poly_eq(aes(label = paste(..rr.label..)), 
               label.x.npc = "right", label.y = "top",
               formula = T38CPUELAG_lm7,rr.digits = 4,  parse = TRUE, size = 3.2) +
  geom_smooth(method = 'lm', se=FALSE, color="black") +
  stat_fit_glance(method = "lm", method.args = list(formula = T38CPUELAG_lm7),
                  label.x = "right",
                  label.y = 0.865,
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 4), sep = "")),
                  parse = TRUE, size = 3.2) +
  labs(y=expression(Landings~CPUE~year^{-1}),
       x=expression(Creek~Trawl~immature~male~CPUE~"(1-yr lag)"~year^{-1}))



SingleRegressPlot <- plot_grid(B90CPUELagPlot, T38CPUELAGPlot, ncol = 1, align = 'hv', labels = c("A", "B")) 
SingleRegressPlot

```

```{r Figure 6, echo=FALSE, message=FALSE, warning=FALSE,dpi=600, fig.cap="Objective 3 - This plot shows no model improvement if Total CPUEs are added together into a multiple regression model.  The adj R^2 is not an improvement over the R^2 of the individual variables  (See Table 4)", fig.width=5,fig.height=3}

MultiCPUELAG_lm1 <- lm(LandPlotcrab$LandingsCPUEMean ~ lag(LandPlotcrab$B90_CPUE, 1)+lag(LandPlotcrab$T38_CPUE, 1))

MultiLagPlot = ggplot(aes(LandingsCPUEMean, lag(LandPlotcrab$B90_CPUE, 1)+lag(LandPlotcrab$T38_CPUE, 1)), data = LandPlotcrab) +
  #ggtitle("Commercial Landings ~ Select Survey Variables") +
  geom_point() +
  stat_fit_glance(method = "lm", method.args = list(formula = MultiCPUELAG_lm1),
                  label.x = "left",
                  label.y = 0.83,
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 3), sep = "")),
                  parse = TRUE, size = 3.2) +
  stat_poly_eq(aes(label = paste(..adj.rr.label..)), 
               label.x.npc = "left", 
               label.y.npc = "top",
               formula = MultiCPUELAG_lm1, rr.digits = 4,  parse = TRUE, size = 3.2) +
  geom_smooth(method = 'lm', se=FALSE, color="black") +
  labs(y=expression(Landings~CPUE~year^{-1}),
       x=expression(Creek~Trawl~CPUE~"(1-yr lag)"~+~Harbor~Trawl~CPUE~"(1-yr lag)"~year^{-1}))

MultiLagPlot

```

\newpage

**Table 6:** Objective 3 - This table shows the results of a dredge function run on the highest correlated variables (Figure 4), the total CPUEs (1-yr. lag) for the Harbor and Creek Trawl surveys (univariate corrs found Table 4).  The multivariate model's Radj^2 was lower than the univariate models.  The multivariate and univariate models were scored using AICc for small samples.  A delta <2.0 from another model's delta means the dredge sees no staistical difference outside of chance between the compared models.  Mean annual population structure variables (Harbor Trawl mature males 1-yr lag, Creek Trawl immature males 1-yr lag) are statistically better models than mean annual total CPUE according to the dredge.
```{r Table 6 Landings Dredge, echo=FALSE, include=TRUE, message=FALSE, warning=FALSE, fig.cap="Objective 3 - This table shows the results of a dredge function run on the highest correlated variables (Figure 4), the total CPUEs (1-yr. lag) for the Harbor and Creek Trawl surveys (univariate corrs found Table 4).  The multivariate model's Radj^2 was lower than the univariate models.  The multivariate was not compared to univariate models.  A delta <2.0 from another model's delta means the dredge sees no staistical difference outside of chance between the compared models.  Population structure variables (Harbor Trawl mature males 1-yr lag, Creek Trawl immature males 1-yr lag) are statistically better models according to the dredge."}
LandDredgeData = read.csv("Ch1data_dredgeLand.csv", header = TRUE) 
LandDredge_lm = lm(Landings ~ ., data = LandDredgeData, na.action = "na.fail") 
LandDredge = dredge(LandDredge_lm)
LandDredgeTable <- subset(LandDredge, delta < 5.01)

LandDredgeKable = kable(LandDredgeTable, "latex", booktabs = T, 
                        col.names = c("Intercept",
                                      "Harbor Trawl",
                                      "Harbor Trawl mature male",
                                      "Creek Trawl",
                                      "Creek Trawl immature male",
                                      "df", 
                                      "logLik",
                                      "AICc",
                                      "delta",
                                      "weight"), digits = 4) %>%
  kable_styling(bootstrap_options = "scale_down", font_size = 8) %>%
  add_header_above(c(" " = 2, "lagged 1-yr." = 4)) %>%
  column_spec(2:6, width = "5em") %>%
  pack_rows("delta Group 1", 1, 2) %>%
  pack_rows("delta Group 2", 3, 10)


LandDredgeKable
```

\newpage
### Discussion
OLS regression models using all lifestages from all surveys with a 1- and 2-yr lag to predict Charleston Harbor watershed (Ashley River, Cooper River, Wando River and Charleston Harbor) landings CPUEs were constructed to find all explanatory relationships.  All significant relationships are displayed in the following tables.  The CRMS Creek Trawl is the most consistently responsive of the surveys when used in regression modeling.  Nine significant relationships exist between mean annual Landings CPUE and several 1- and 2-yr.lagged lifestage variables from the CRMS Harbor and Creek Trawl surveys (Table 4).  The CRMS Harbor Trawl survey's mature males 1-yr. lag and the CRMS Creek Trawl survey's immature male 1-yr. lag are the only variables with a coefficient of determination (r-squared) > 0.40.  Multiple regression OLS models populated with these variables did not improve correlation.  
\newline
Only two fisheries independent life stage abundance CPUEs have significant relatioships with total landings (not effort corrected).  The effects from these models have very small explanatory power over total landings. It should be mentioned that >2003 is when data from all 4 reporting areas (Ashley, Cooper, Wando Rivers and Charleston Harbor) and the effort-correction (pots pulled) begin.  


